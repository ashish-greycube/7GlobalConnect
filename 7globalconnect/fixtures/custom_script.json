[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Job Order", 
  "modified": "2018-09-22 18:00:11.076267", 
  "name": "Job Order-Client", 
  "script": "frappe.ui.form.on(\"Job Order\", {\n    sales_order: function (frm) {\n        frm.add_fetch(\"sales_order\", \"customer\", \"customer\");\n        frm.add_fetch(\"sales_order\", \"customer_name\", \"customer_name\");\n        frm.add_fetch(\"sales_order\", \"customer_address\", \"customer_address\");\n        frm.add_fetch(\"sales_order\", \"address_display\", \"address_display\");\n        frm.add_fetch(\"sales_order\", \"contact_person\", \"contact_person\");\n        frm.add_fetch(\"sales_order\", \"contact_mobile\", \"contact_mobile\");\n        frm.add_fetch(\"sales_order\", \"contact_display\", \"contact_display\");\n        frm.add_fetch(\"sales_order\", \"contact_email\", \"contact_email\");\n        frm.add_fetch(\"sales_order\", \"delivery_date\", \"delivery_date\");\n    }\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-09-21 18:39:54.057175", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on('Sales Invoice Item', {\n    item_code: function(frm,cdt,cdn) {\n        // do your stuff\n        frm.trigger('set_items_commission_rate');\n    }\n});\n\n\nfrappe.ui.form.on(\"Sales Invoice\", {\n    commission_type: function (frm, cdt, cdn) {\n        frm.trigger('set_items_commission_rate');\n    },\n    validate: function (frm, cdt, cdn) {\n        frm.trigger('set_items_commission_rate');\n    },\n    items_add: function (frm, cdt, cdn) {\n        frm.trigger('set_items_commission_rate');\n    },\n\n    set_items_commission_rate: function (frm) {\n        let commission_type_map = {\n            \"Initial Sales\": \"initial_sales_commission\",\n            \"Yearly Renewal\": \"yearly_renewal_commission\",\n            \"Referral Fees- Initial Sales\": \"referral_fees\"\n        }\n\n\n        frm.add_fetch(\"item_code\", commission_type_map[frm.doc.commission_type], \"commission_rate\");\n            let items = $.map(frm.doc.items, function (i) { return i.item_code });\n            frappe.call({\n                method: \"frappe.client.get_list\",\n                args: {\n                    doctype: \"Item\",\n                    filters: {\n                        \"item_code\": [\"in\", items.join(', ')],\n                    },\n                    fields: [\"initial_sales_commission\", \"yearly_renewal_commission\", \"referral_fees\", \"item_code\"],\n                },\n            }).then(function (r) {\n                if (r.message) {\n                    let total_commission = 0;\n                    let total_base_net = 0;\n                    for (let d of frm.doc.items) {\n                        let item = r.message.filter(function (i) { return i.item_code == d.item_code });\n                        d.commission_rate = flt(item[0][commission_type_map[frm.doc.commission_type]]);\n                        total_commission += flt(d.base_net_amount) * flt(d.commission_rate / 100);\n                        total_base_net +=flt(d.base_net_amount)\n                    }\n                    frm.refresh_field(\"items\");\n                    frm.set_value(\"total_commission\", total_commission);\n                    frm.set_value(\"commission_rate\",flt((total_commission/total_base_net)*100,1));                    \n                }\n            });\n    }\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Domain Registration", 
  "modified": "2018-09-22 17:50:26.578973", 
  "name": "Domain Registration-Client", 
  "script": "frappe.ui.form.on(\"Domain Registration\", {\n    sales_order: function (frm) {\n        frm.add_fetch(\"sales_order\", \"customer\", \"customer\");\n        frm.add_fetch(\"sales_order\", \"customer_name\", \"customer_name\");\n        frm.add_fetch(\"sales_order\", \"customer_address\", \"customer_address\");\n        frm.add_fetch(\"sales_order\", \"address_display\", \"address_display\");\n        frm.add_fetch(\"sales_order\", \"contact_person\", \"contact_person\");\n        frm.add_fetch(\"sales_order\", \"contact_mobile\", \"contact_mobile\");\n        frm.add_fetch(\"sales_order\", \"contact_display\", \"contact_display\");\n        frm.add_fetch(\"sales_order\", \"contact_email\", \"contact_email\");\n        frm.add_fetch(\"sales_order\", \"transaction_date\", \"purchase_date\");\n\n    },\n    purchase_date: function (frm) {\n        frm.set_value(\"expiry_date\", frappe.datetime.add_months(frm.doc.purchase_date, 12));\n    },\n    employee: function (frm) {\n        frappe.call({\n            method: 'frappe.client.get_value',\n            args: {\n                'doctype': 'Employee',\n                'filters': {\n                    'name': frm.doc.employee\n                },\n                'fieldname': [\n                    'prefered_email','cell_number'\n                ]\n            },\n            callback: function (r) {\n                if (!r.exc) {\n                    if (r.message) {\n                        data=r.message\n                        frm.set_value(\"prefered_email\", data.prefered_email)\n                        frm.set_value(\"sales_person_cell\", data.cell_number)\n                    }\n                }\n            }\n        })\n    }\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "CP58 Statement", 
  "modified": "2018-09-22 14:43:03.947366", 
  "name": "CP58 Statement-Client", 
  "script": "frappe.ui.form.on(\"CP58 Statement\", {\n\n    company: function (frm) {\n        frappe.call({\n            \"method\": \"frappe.client.get_value\",\n            args: {\n                doctype: \"Company\",\n                fieldname: \"payer_officer\",\n                filters: {\n                    company_name: [\"=\", frm.doc.company]\n                }\n            },\n            callback: function (r) {\n                data=r.message\n                if (data) {\n                    frm.set_value(\"payer_officer_emp_id\", data.payer_officer) \n                }\n            }\n        });\n        frappe.call({\n            \"method\": \"7globalconnect.sevenglobalconnect.doctype.cp58_statement.cp58_statement.get_company_address\",\n            args: {\n                company: frm.doc.company\n            },\n            callback: function (r) {\n                data=r.message[0]\n                if (data) {\n                    company_address=data.address_line1+\"\\n\"+data.address_line2+\"\\n\"+data.city+\"\\n\"+data.pincode+\"\\n\"+data.country\n                    frm.set_value(\"company_address\",company_address)\n                }\n            }\n        });\n\n    },\n    payer_officer_emp_id: function (frm) {\n        frappe.call({\n            method: \"frappe.client.get_value\",\n            args: {\n                doctype: \"Employee\",\n                filters: {\n                    name: [\"=\", frm.doc.payer_officer_emp_id]\n                },\n                fieldname: [\"employee_name\", \"designation\", \"passport_number\"]\n            },\n        }).then(function (r) {\n            if (r.message) {\n                frm.set_value(\"officer_name\", r.message.employee_name)\n                frm.set_value(\"officer_passport\", r.message.passport_number)\n                frm.set_value(\"officer_designation\", r.message.designation)\n            }\n        })\n\n    },\n\n    sales_person: function (frm) {\n        frappe.call({\n            method: \"frappe.client.get_value\",\n            args: {\n                doctype: \"Employee\",\n                filters: {\n                    employee_name: [\"=\", frm.doc.sales_person]\n                },\n                fieldname: [\"prefered_email\", \"permanent_address\", \"passport_number\", \"is_malaysian_resident\"]\n            },\n        }).then(function (r) {\n            if (r.message) {\n                frm.set_value(\"sales_person_email\", r.message.prefered_email)\n                frm.set_value(\"sales_person_address\", r.message.permanent_address)\n                frm.set_value(\"sales_person_passport\", r.message.passport_number)\n                frm.set_value(\"is_malyasian_resident\", r.message.is_malaysian_resident)\n            }\n        })\n    },\n    statement_for: function (frm, cdt, cdn) {\n        if (frm.doc.statement_for == \"Monthly\") {\n            frm.doc.from_date = frappe.datetime.month_start()\n            frm.doc.to_date = frappe.datetime.month_end()\n            frm.doc.period = moment().format('MMM YYYY')\n        } else if (frm.doc.statement_for == \"Yearly\") {\n            frm.doc.from_date = moment().subtract(1, 'year').startOf(\"year\").format()\n            frm.doc.to_date = moment().subtract(1, 'year').endOf(\"year\").format()\n            frm.doc.period = new Date(moment().subtract(1, 'year').toDate()).getFullYear()\n\n        }\n        frm.refresh_field('from_date');\n        frm.refresh_field('to_date');\n        frm.refresh_field('period');\n        frm.trigger('set_total_commission');\n    },\n    from_date: function (frm) {\n        frm.trigger('set_total_commission');\n    },\n    to_date: function (frm) {\n        frm.trigger('set_total_commission');\n    },\n    set_total_commission: function (frm) {\n        frappe.call({\n            method: '7globalconnect.api.getcomission',\n            args: {\n                sales_person: frm.doc.sales_person,\n                from_date: frm.doc.from_date,\n                to_date: frm.doc.to_date\n            },\n            callback: function (r) {\n                if (r.message) {\n                    data = r.message\n                    if (data[0].commission) {\n                        frm.doc.total_commission = data[0].commission\n                    } else {\n                        frm.doc.total_commission = 0\n                    }\n                    frm.refresh_field('total_commission');\n\n                }\n            }\n        });\n\n    },\n    validate: function (frm) {\n\n                // var msg = \"Please fill mandotory fields in respective doctypes\";\n                // msgprint(msg);\n                // throw msg;\n\n\n    }\n\n});", 
  "script_type": "Client"
 }
]