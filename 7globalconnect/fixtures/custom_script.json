[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Job Order", 
  "modified": "2018-04-16 17:41:51.791532", 
  "name": "Job Order-Client", 
  "script": "cur_frm.add_fetch(\"sales_order\", \"customer\", \"customer\");\ncur_frm.add_fetch(\"sales_order\", \"customer_name\", \"customer_name\");\ncur_frm.add_fetch(\"sales_order\", \"customer_address\", \"customer_address\");\ncur_frm.add_fetch(\"sales_order\", \"address_display\", \"address_display\");\ncur_frm.add_fetch(\"sales_order\", \"contact_person\", \"contact_person\");\ncur_frm.add_fetch(\"sales_order\", \"contact_mobile\", \"contact_mobile\");\ncur_frm.add_fetch(\"sales_order\", \"contact_display\", \"contact_display\");\ncur_frm.add_fetch(\"sales_order\", \"contact_email\", \"contact_email\");\ncur_frm.add_fetch(\"sales_order\", \"delivery_date\", \"delivery_date\");", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-09-18 00:29:13.902228", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on(\"Sales Invoice\", {\n    validate: function (frm) {\n        var commission_type\n        var item_commission_rate\n        var Item_commission_amount=0\n        frm.doc.total_commission=0\n       \n\n        //get field name as per commission type\n        if (frm.doc.commission_type == \"Initial Sales\") {\n            commission_type = \"initial_sales_commission\"\n        } else if (frm.doc.commission_type == \"Yearly Renewal\") {\n            commission_type = \"yearly_renewal_commission\"\n        } else if (frm.doc.commission_type == \"Referral Fees- Initial Sales\") {\n            commission_type = \"referral_fees\"\n        }\n        frappe.run_serially([\n            () => {        //loop through child table\n                $.each(frm.doc.items || [], function (i, v) {\n                    frappe.run_serially([\n                        () => {\n                            frappe.call({\n                                method: 'frappe.client.get_value',\n                                args: {\n                                    'doctype': 'Item',\n                                    'filters': {\n                                        'item_code': v.item_code\n                                    },\n                                    'fieldname': [\n                                        commission_type,\n                                    ]\n                                },\n                                callback: function (r) {\n                                    if (!r.exc) {\n                                        if (r.message) {\n                                            rate = Object.values(r.message)[0]\n                                            frappe.model.set_value(v.doctype, v.name, \"commission_rate\", rate)\n                                        }\n                                    }\n                                }\n                            })\n                        },\n                        () => {\n                            if (v.net_base_amount && v.commission_rate) {\n                                Item_commission_amount  = (v.net_base_amount * (v.commission_rate /100))+Item_commission_amount\n                                console.log(v.net_base_amount)\n                                console.log(v.commission_rate)\n                                console.log(Item_commission_amount)\n                            }\n        \n                        } \n                    ]);\n                    \n        \n                })},\n            () => {        frm.doc.total_commission=Item_commission_amount\n                console.log(Item_commission_amount)\n                console.log(frm.doc.total_commission)\n                console.log(cur_frm.doc.total_commission)\n                //frm.refresh_field('total_commission');\n                frm.refresh_field('items');}\n        ]);\n    },\n    commission_type: function (frm, cdt, cdn) {\n        if (frm.doc.commission_type == \"Initial Sales\") {\n            frm.add_fetch(\"item_code\", \"initial_sales_commission\", \"commission_rate\");\n        } else if (frm.doc.commission_type == \"Yearly Renewal\") {\n            frm.add_fetch(\"item_code\", \"yearly_renewal_commission\", \"commission_rate\");\n        } else if (frm.doc.commission_type == \"Referral Fees- Initial Sales\") {\n            frm.add_fetch(\"item_code\", \"referral_fees\", \"commission_rate\");\n        }\n    }\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Domain Registration", 
  "modified": "2018-09-18 18:25:56.272980", 
  "name": "Domain Registration-Client", 
  "script": "cur_frm.add_fetch(\"sales_order\", \"customer\", \"customer\");\ncur_frm.add_fetch(\"sales_order\", \"customer_name\", \"customer_name\");\ncur_frm.add_fetch(\"sales_order\", \"customer_address\", \"customer_address\");\ncur_frm.add_fetch(\"sales_order\", \"address_display\", \"address_display\");\ncur_frm.add_fetch(\"sales_order\", \"contact_person\", \"contact_person\");\ncur_frm.add_fetch(\"sales_order\", \"contact_mobile\", \"contact_mobile\");\ncur_frm.add_fetch(\"sales_order\", \"contact_display\", \"contact_display\");\ncur_frm.add_fetch(\"sales_order\", \"contact_email\", \"contact_email\");\ncur_frm.add_fetch(\"sales_order\", \"transaction_date\", \"purchase_date\");\ncur_frm.cscript.purchase_date = function (doc, cdt, cd) {\n    cur_frm.set_value(\"expiry_date\", frappe.datetime.add_months(doc.purchase_date, 12));\n}\ncur_frm.cscript.employee = function (doc, cdt, cd) {\n    cur_frm.add_fetch(\"employee\", \"prefered_email\", \"prefered_email\");\n}\nfrappe.ui.form.on(\"Domain Registration\", {\n    employee: function (frm) {\n        frappe.call({\n            method: 'frappe.client.get_value',\n            args: {\n                'doctype': 'Employee',\n                'filters': {\n                    'name': frm.doc.employee\n                },\n                'fieldname': [\n                    'prefered_email',\n                ]\n            },\n            callback: function (r) {\n                if (!r.exc) {\n                    if (r.message) {\n                        frm.doc.prefered_email=''\n                        frappe.model.set_value(\"Domain Registration\", frm.doc.name, \"prefered_email\", r.message.prefered_email)\n                    }\n                }\n            }\n        })\n    }\n});\n", 
  "script_type": "Client"
 }
]